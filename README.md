# homebridge-apsystem-inverter
AP Systems Inverter plugin for Homebridge

This plugin shows you total kilo watts per hour generated today and last watts generated by your AP Systems inverter monitor by an ECU.

## Features

- Supports both newer HTTPS API and legacy HTTP API
- Configurable API endpoints
- Optional API authentication token support
- Improved error handling and response parsing
- Backward compatible with existing configurations

## Installation

```bash
npm install -g homebridge-apsystem-inverter
```

## Configuration

Add to your `config.json` in the `accessories` section:

### Basic Configuration (Newer API - HTTPS)

```json
"accessories": [
    {
        "accessory": "APSystemsInverter",
        "name": "Watts",
        "ecuId": "XXXXXXXXXXXX",
        "inverter_data": "Watts"
    },
    {
        "accessory": "APSystemsInverter",
        "name": "kWh",
        "ecuId": "XXXXXXXXXXXX",
        "inverter_data": "Kwh"
    }
]
```

### Advanced Configuration (with API authentication)

```json
"accessories": [
    {
        "accessory": "APSystemsInverter",
        "name": "Watts",
        "ecuId": "XXXXXXXXXXXX",
        "inverter_data": "Watts",
        "apiToken": "your-api-token-here",
        "apiBaseUrl": "https://api.apsystemsema.com",
        "apiPath": "/apsema/v1/ecu/getPowerInfo",
        "apiPort": 443
    }
]
```

### Legacy API Configuration (HTTP)

If you need to use the old HTTP API endpoint:

```json
"accessories": [
    {
        "accessory": "APSystemsInverter",
        "name": "Watts",
        "ecuId": "XXXXXXXXXXXX",
        "inverter_data": "Watts",
        "useLegacyApi": true
    }
]
```

## Configuration Options

| Option | Type | Required | Default | Description |
|--------|------|----------|---------|-------------|
| `name` | string | Yes | - | Display name for the accessory |
| `ecuId` | string | Yes | - | Your AP Systems ECU ID |
| `inverter_data` | string | Yes | - | Either "Watts" or "Kwh" |
| `apiToken` | string | No | null | API authentication token (if required) |
| `apiBaseUrl` | string | No | `https://api.apsystemsema.com` | Base URL for the API |
| `apiPath` | string | No | `/apsema/v1/ecu/getPowerInfo` | API endpoint path |
| `apiPort` | number | No | `443` | API port (443 for HTTPS, 8073 for legacy HTTP) |
| `useLegacyApi` | boolean | No | `false` | Set to `true` to use legacy HTTP endpoint |
| `manufacturer` | string | No | `AP Systems` | Manufacturer name |
| `model` | string | No | `Inverter` | Model name |
| `serial` | string | No | `APSystems-inverter` | Serial number |
| `min_lux` | number | No | `0` | Minimum lux value |
| `max_lux` | number | No | `10000` | Maximum lux value |

## Changelog

### Version 0.4.0
- Updated to support newer AP Systems APIs with HTTPS
- Added support for API authentication tokens
- Made API endpoints configurable
- Improved error handling and response parsing
- Updated dependencies to latest versions
- Added backward compatibility with legacy HTTP API
- Updated Node.js requirement to >=14.0.0

### Version 0.3.0
- Initial release with HTTP API support
